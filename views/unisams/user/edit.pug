extends ../layout

block page_includes
    link(rel='stylesheet', href='/static/unisams/stylesheets/lssc_loader_userprofile.css')
    link(rel='stylesheet', href='/static/unisams/stylesheets/editUser.css')
    script(src="/static/unisams/js/userprofile.js")
    script(src="/static/unisams/js/editUser.js")
    script(src="/static/unisams/js/actions.js")
    script(src="/static/unisams/js/updateUser.js")
    script(src="/static/unisams/js/transformToNewScheme.js")

    script(src="/lib/fineUploader/fine-uploader.js")
    link(rel='stylesheet', href='/lib/fineUploader/fine-uploader-new.css')

    script(type="text/template" id="qq-template-manual-trigger")
        <div class="qq-uploader-selector qq-uploader" qq-drop-area-text="Drop files here">
        <div class="qq-total-progress-bar-container-selector qq-total-progress-bar-container">
        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-total-progress-bar-selector qq-progress-bar qq-total-progress-bar"></div>
        </div>
        <div class="qq-upload-drop-area-selector qq-upload-drop-area" qq-hide-dropzone>
        <span class="qq-upload-drop-area-text-selector"></span>
        </div>
        <div class="buttons">
        <div class="qq-upload-button-selector qq-upload-button">
        <div>Select files</div>
        </div>
        </div>
        <span class="qq-drop-processing-selector qq-drop-processing">
        <span>Processing dropped files...</span>
        <span class="qq-drop-processing-spinner-selector qq-drop-processing-spinner"></span>
        </span>
        <ul class="qq-upload-list-selector qq-upload-list" aria-live="polite" aria-relevant="additions removals">
        <li>
        <div class="qq-progress-bar-container-selector">
        <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" class="qq-progress-bar-selector qq-progress-bar"></div>
        </div>
        <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
        <img class="qq-thumbnail-selector" qq-max-size="100" qq-server-scale>
        <span class="qq-upload-file-selector qq-upload-file"></span>
        <span class="qq-edit-filename-icon-selector qq-edit-filename-icon" aria-label="Edit filename"></span>
        <input class="qq-edit-filename-selector qq-edit-filename" tabindex="0" type="text">
        <span class="qq-upload-size-selector qq-upload-size"></span>
        <button type="button" class="qq-btn qq-upload-cancel-selector qq-upload-cancel">Cancel</button>
        <button type="button" class="qq-btn qq-upload-retry-selector qq-upload-retry">Retry</button>
        <button type="button" class="qq-btn qq-upload-delete-selector qq-upload-delete">Delete</button>
        <span role="status" class="qq-upload-status-text-selector qq-upload-status-text"></span>
        </li>
        </ul>

        <dialog class="qq-alert-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
        <button type="button" class="qq-cancel-button-selector">Close</button>
        </div>
        </dialog>

        <dialog class="qq-confirm-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <div class="qq-dialog-buttons">
        <button type="button" class="qq-cancel-button-selector">No</button>
        <button type="button" class="qq-ok-button-selector">Yes</button>
        </div>
        </dialog>

        <dialog class="qq-prompt-dialog-selector">
        <div class="qq-dialog-message-selector"></div>
        <input type="text">
        <div class="qq-dialog-buttons">
        <button type="button" class="qq-cancel-button-selector">Cancel</button>
        <button type="button" class="qq-ok-button-selector">Ok</button>
        </div>
        </dialog>
        </div>



    script.
        window.exploreUserId = "#{exploreUser.id}";
        window.activeDockerSection = "usermanagement";
block content
    #wrapper
        #page-container.page-container
            #page-container-inner.page-container-inner.full-width.full-height
                section#sec1
                    #sec-content.subpage-container
                        #content1-heading.sec-heading.subpage-heading
                            .userimg-container.sec-heading-img
                                .userimg
                                    .userimg-overlay.changeProfilePicture
                                        .userimg-inner
                                            svg(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-camera") <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                                            span Bild ändern
                                    img#userProfileImage.userProfileImage(src="/data/uploads/user_images/" + exploreUser.id + "/" + exploreUser.id + ".jpg")

                            .sec-heading-label.userprofile-heading
                                .userprofile-heading-container
                                    h3=exploreUser.generalData.firstName + " " + exploreUser.generalData.lastName
                                    .userprofile-dropdown.dropdown-menu
                                        .dropdown-btn
                                            svg(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-vertical") <circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>

                                            .dropdown-container
                                                .dropdown-entry
                                                    a.before-icon.icon-back(id="view" + exploreUser.id, data-userid=exploreUser.id href="/unisams/user/" + exploreUser.username) Bearbeitung beenden
                                                .dropdown-entry
                                                    a.before-icon.icon-delete.userDelete(id="deleteUserId" + exploreUser.id, data-userid=exploreUser.id) Mitglied löschen
                                                .dropdown-entry
                                                    a.userTransform(id="transformUser" + exploreUser.id, onclick="transformUser('" + exploreUser.id + "')") (dev) transform to new scheme
                                                .dropdown-entry
                                                    a.userTransform(id="deleteOldId" + exploreUser.id, onclick="removeOld('"+exploreUser.id+"')") (dev) remove invalid fields
                                    .clear
                                .clear
                        #content1-text.sec-content
                            .subpage-content
                                .userinfo-container
                                    #tabnav-container
                                        ul
                                            li
                                                a(href="#tab-userinfo-general")
                                                    span Allgemeine Informationen
                                            li
                                                a(href="#tab-userinfo-qualification")
                                                    span Qualifikationen
                                            li
                                                a(href="#tab-userinfo-role")
                                                    span Rechte und Rollen

                                        #tab-userinfo-general.userinfo-inner
                                            form.userForm.userinfo-section
                                                .userinfo-sectionheader
                                                    span unisams
                                                .userinfo-item.useredit-item(id="useritem-username")
                                                    span.userinfo-item-label.userinfo-attribute-name Username:
                                                    input#userinp-username.userForm-inp(value = exploreUser.username, name="username" type="text")
                                                    .useredit-saveItemBtn.useredit-actionBtn.before-icon.icon-confirm.has-tooltip.disabled(data-attributekey ="username", data-attributeval=exploreUser.username, data-dialogtitlearg="username", data-dialogbodyarg=exploreUser.username)
                                                        span.tooltip.tt-enabled Speichern
                                                        span.tooltip.tt-disabled keine Änderungen zum Speichern
                                                    .useredit-resetItemBtn.useredit-actionBtn.before-icon.icon-cancel.has-tooltip.disabled(data-attributekey ="username", data-attributeval=exploreUser.username, data-dialogtitlearg="username", data-dialogbodyarg=exploreUser.username)
                                                        span.tooltip.tt-enabled Zurücksetzen
                                                        span.tooltip.tt-disabled keine Änderungen zum Zurücksetzen
                                                    .clear

                                            form.userForm.userinfo-section
                                                .userinfo-sectionheader
                                                    span Allgemeine Daten
                                                .userinfo-item.useredit-item(id="useritem-generalData.firstName")
                                                    span.userinfo-item-label.userinfo-attribute-name Vorname:
                                                    input.userForm-inp(id="userinp-generalData.firstName" value = exploreUser.generalData.firstName, name="firstName" type="text")
                                                    .useredit-saveItemBtn.useredit-actionBtn.before-icon.icon-confirm.has-tooltip.disabled(data-attributekey ="generalData.firstName", data-attributeval=exploreUser.generalData.firstName, data-dialogtitlearg="firstName", data-dialogbodyarg=exploreUser.generalData.firstName)
                                                        span.tooltip.tt-enabled Speichern
                                                        span.tooltip.tt-disabled keine Änderungen zum Speichern
                                                    .useredit-resetItemBtn.useredit-actionBtn.before-icon.icon-cancel.has-tooltip.disabled(data-attributekey ="generalData.firstName", data-attributeval=exploreUser.generalData.firstName, data-dialogtitlearg="firstName", data-dialogbodyarg=exploreUser.generalData.firstName)
                                                        span.tooltip.tt-enabled Zurücksetzen
                                                        span.tooltip.tt-disabled keine Änderungen zum Zurücksetzen
                                                    .clear
                                                .userinfo-item.useredit-item(id="useritem-generalData.lastName")
                                                    span.userinfo-item-label.userinfo-attribute-name Nachname:
                                                    input.userForm-inp(id="userinp-generalData.lastName" value= exploreUser.generalData.lastName name="lastName" type="text")
                                                    .useredit-saveItemBtn.useredit-actionBtn.before-icon.icon-confirm.has-tooltip.disabled(data-attributekey ="generalData.lastName", data-attributeval=exploreUser.generalData.lastName, data-dialogtitlearg="lastName", data-dialogbodyarg=exploreUser.generalData.lastName)
                                                        span.tooltip.tt-enabled Speichern
                                                        span.tooltip.tt-disabled keine Änderungen zum Speichern
                                                    .useredit-resetItemBtn.useredit-actionBtn.before-icon.icon-cancel.has-tooltip.disabled(data-attributekey ="generalData.lastName", data-attributeval=exploreUser.generalData.lastName, data-dialogtitlearg="lastName", data-dialogbodyarg=exploreUser.generalData.lastName)
                                                        span.tooltip.tt-enabled Zurücksetzen
                                                        span.tooltip.tt-disabled keine Änderungen zum Zurücksetzen
                                                    .clear
                                                .userinfo-item.useredit-item(id="useritem-generalData.memberId")
                                                    span.userinfo-item-label.userinfo-attribute-name Mitgliedsnummer:
                                                    input.userForm-inp(id="userinp-generalData.memberId" value= exploreUser.generalData.memberId name="memberId" type="text")
                                                    .useredit-saveItemBtn.useredit-actionBtn.before-icon.icon-confirm.has-tooltip.disabled(data-attributekey ="generalData.memberId", data-attributeval=exploreUser.generalData.memberId, data-dialogtitlearg="memberId", data-dialogbodyarg=exploreUser.generalData.memberId)
                                                        span.tooltip.tt-enabled Speichern
                                                        span.tooltip.tt-disabled keine Änderungen zum Speichern
                                                    .useredit-resetItemBtn.useredit-actionBtn.before-icon.icon-cancel.has-tooltip.disabled(data-attributekey ="generalData.memberId", data-attributeval=exploreUser.generalData.memberId, data-dialogtitlearg="memberId", data-dialogbodyarg=exploreUser.generalData.memberId)
                                                        span.tooltip.tt-enabled Zurücksetzen
                                                        span.tooltip.tt-disabled keine Änderungen zum Zurücksetzen
                                                    .clear

                                            .userinfo-section
                                                .userinfo-sectionheader
                                                    span Kontaktdaten
                                                div
                                                    ul.userlist.itemlist.userinfo-itemList
                                                        if exploreUserDocument.contactData
                                                            - var secKey = "contactData"
                                                            - var secVal = exploreUserDocument.contactData
                                                            if secVal.email
                                                                - var subKey = "email"
                                                                - var subsecKey = secKey + "." + subKey
                                                                - var subsecVal = secVal.email
                                                                each val, key in subsecVal
                                                                    - var title = (val.title ? 'Email ('+val.title + ')' : "Email")
                                                                    - var combinedKey = subsecKey + "." + key
                                                                    - var value = val.value
                                                                    li.user-entry.userkey-entry(id="userinp-" + combinedKey, data-isarray= true, data-catkey=secKey, data-subkey=subKey, data-key=combinedKey, data-keyid= val.id, data-value=value)
                                                                        a.inner()
                                                                            .item-property.userkey-entry-title= title
                                                                            .item-property.userkey-entry-value= value
                                                                            .clear

                                                                    //.userinfo-item(id="useritem-" + combinedKey)
                                                                    //    span.userinfo-item-label.userinfo-attribute-name=title
                                                                    //    input.userForm-inp(id="userinp-" + combinedKey, value=value, name=value, data-isArray="true", type="text")

                                                            if secVal.phone
                                                                - var subKey = "phone"
                                                                - var subsecKey = secKey + "." + subKey
                                                                - var subsecVal = secVal.phone
                                                                each val, key in subsecVal
                                                                    - var title = (val.title ? 'Telefon ('+val.title + ')' : "Telefon")
                                                                    - var combinedKey = subsecKey + "." + key
                                                                    - var value = val.value
                                                                    li.user-entry.userkey-entry(id="userkey-" + combinedKey, data-isarray= true, data-catkey=secKey, data-subkey=subKey, data-key=combinedKey, data-keyid= val.id, data-value=value)
                                                                        a.inner()
                                                                            .item-property.userkey-entry-title= title
                                                                            .item-property.userkey-entry-value= value
                                                                            .clear

                                            form.userForm.userinfo-section
                                                .userinfo-sectionheader
                                                    span weitere Daten
                                                if exploreUserDocument.customData
                                                    each val, key in exploreUserDocument.customData
                                                        .userinfo-item(id="useritem-"+"customData."+key)
                                                            span.userinfo-item-label.userinfo-attribute-name= key
                                                            input.userForm-inp(id="userinp-"+"customData."+key value= val name=key type="text")
                                                            .useredit-saveItemBtn.useredit-actionBtn.before-icon.icon-confirm.has-tooltip.disabled(data-attributekey ="customData."+key, data-attributeval=val, data-dialogtitlearg=key, data-dialogbodyarg=val)
                                                                span.tooltip.tt-enabled Speichern
                                                                span.tooltip.tt-disabled keine Änderungen zum Speichern
                                                            .useredit-resetItemBtn.useredit-actionBtn.before-icon.icon-cancel.has-tooltip.disabled(data-attributekey ="customData."+key, data-attributeval=val, data-dialogtitlearg=key, data-dialogbodyarg=val)
                                                                span.tooltip.tt-enabled Zurücksetzen
                                                                span.tooltip.tt-disabled keine Änderungen zum Zurücksetzen
                                                            .useredit-removeItemBtn.useredit-actionBtn.before-icon.icon-delete.has-tooltip(data-attributekey ="customData."+ key, data-attributeval=val, data-dialogtitlearg=key, data-dialogbodyarg=val)
                                                                span.tooltip Löschen

                                                .userinfo-item.useredit-item.useredit-addItem
                                                    .useredit-addItemBtn.btn-addItem
                                                        svg(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus") <line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                                        span Hinzufügen
                                                        .clear

                                        #tab-userinfo-qualification.userinfo-inner
                                            .userinfo-section
                                                .userinfo-sectionheader
                                                    span Qualifikationen
                                                div
                                                    ul.userlist.itemlist.userinfo-itemList
                                                        li.user-entry.noSelect.borderBottom
                                                            .inner
                                                                .item-property Typ
                                                                .item-property Bezeichnung
                                                        if exploreUserDocument.qualifications
                                                            each val in exploreUserDocument.qualifications
                                                                li.user-entry.quallist-entry(id= "qualId" + val.id data-qualificationid= val.id)
                                                                    a.inner()
                                                                        .item-property= val.qualification.qualType
                                                                        .item-property= val.qualification.name
                                                                        .clear


                                                        .userinfo-item.useredit-item.useredit-addItem
                                                            .useredit-addQualificationBtn.btn-addItem.btn-listExt
                                                                svg(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus") <line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                                                span Hinzufügen
                                                                .clear

                                        #tab-userinfo-role.userinfo-inner
                                            .userinfo-section
                                                .userinfo-sectionheader
                                                    span Rollen

                            #profilemanagment-menu.subpage-menu
                                #btn01.subpage-menu-btn
                                    a.content-link.style2.float(href="/unisams/user")
                                        svg.icon(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left") <polyline points="15 18 9 12 15 6"></polyline></svg>
                                        span Zurück


